<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DealFlowAI Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #4CAF50;
            --text-primary: #333;
            --text-secondary: #666;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: rgba(255, 255, 255, 0.95);
            --border-color: rgba(102, 126, 234, 0.2);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
            --shadow-hover: 0 15px 40px rgba(0,0,0,0.15);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #4CAF50, #45a049);
            --gradient-dark: linear-gradient(135deg, #1a1a2e, #16213e);
            --gradient-card: linear-gradient(135deg, #f8f9fa, #ffffff);
            --gradient-card-dark: linear-gradient(135deg, #2d3748, #4a5568);
        }
        
        [data-theme="dark"] {
            --primary-color: #8b5cf6;
            --secondary-color: #a855f7;
            --accent-color: #10b981;
            --text-primary: #f7fafc;
            --text-secondary: #a0aec0;
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-card: rgba(45, 55, 72, 0.95);
            --border-color: rgba(139, 92, 246, 0.3);
            --shadow: 0 8px 32px rgba(0,0,0,0.3);
            --shadow-hover: 0 15px 40px rgba(0,0,0,0.4);
            --gradient-primary: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            --gradient-secondary: linear-gradient(135deg, #10b981, #059669);
            --gradient-dark: linear-gradient(135deg, #1a1a2e, #16213e);
            --gradient-card: linear-gradient(135deg, #2d3748, #4a5568);
            --gradient-card-dark: linear-gradient(135deg, #1a202c, #2d3748);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: var(--text-primary);
            font-size: 2.5em;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .last-update {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Advanced animations and effects */
        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            }
        }

        .metric-card {
            animation: fadeInUp 0.6s ease-out;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-hover);
        }

        .dashboard-card {
            animation: slideInFromRight 0.8s ease-out;
            transition: all 0.3s ease;
        }

        .history-card {
            animation: slideInFromLeft 0.6s ease-out;
            transition: all 0.3s ease;
        }

        .history-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-hover);
        }

        /* 3D Transform effects */
        .metric-card, .dashboard-card, .history-card {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .metric-card:hover, .dashboard-card:hover, .history-card:hover {
            transform: translateY(-5px) rotateX(2deg) rotateY(2deg);
        }

        /* Glowing effects for important elements */
        .metric-value {
            transition: all 0.3s ease;
        }

        .metric-value:hover {
            animation: glow 1s ease-in-out infinite;
        }

        /* Floating animation for cards */
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        .feature-card {
            animation: float 3s ease-in-out infinite;
        }

        /* Gradient text effect */
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Particle system */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            animation: particleFloat 8s linear infinite;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Animated background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 175, 80, 0.1) 0%, transparent 50%);
            z-index: -2;
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(1deg);
            }
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--primary-color);
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover {
            background: var(--primary-color);
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            color: var(--text-primary);
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s;
        }

        .metric-card:hover::before {
            transform: translateX(0);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-prospecting { background: #ffeaa7; color: #d63031; }
        .status-qualification { background: #a29bfe; color: white; }
        .status-proposal { background: #fd79a8; color: white; }
        .status-negotiation { background: #fdcb6e; color: var(--text-primary); }
        .status-due_diligence { background: #00b894; color: white; }
        .status-closed_won { background: #00cec9; color: white; }
        .status-closed_lost { background: #e17055; color: white; }

        .fit-score {
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .fit-high { background: #00b894; color: white; }
        .fit-medium { background: #fdcb6e; color: var(--text-primary); }
        .fit-low { background: #e17055; color: white; }

        .industry-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .industry-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .industry-count {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .industry-name {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 18px;
        }

        .error {
            background: rgba(192, 57, 43, 0.1);
            color: #c0392b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: var(--secondary-color);
        }

        .home-btn {
            background: var(--accent-color);
        }

        .home-btn:hover {
            background: #059669;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .filter-section {
            padding: 20px 0;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-row input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-row select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            min-width: 150px;
        }

        /* Advanced Analytics Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analytics-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
        }

        .analytics-title {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .analytics-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .analytics-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .trend-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .trend-up {
            background: #00b894;
            color: white;
        }

        .trend-down {
            background: #e17055;
            color: white;
        }

        .trend-neutral {
            background: #fdcb6e;
            color: var(--text-primary);
        }

        /* Advanced Visualizations Styles */
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .viz-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .viz-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .viz-card h4 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .heatmap-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .heatmap-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .heatmap-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .funnel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .funnel-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .funnel-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .chart-container canvas {
            border-radius: 10px;
        }

        /* Performance Metrics */
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .performance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .performance-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .performance-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* Pipeline Visualization */
        .pipeline-visualization {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }

        .pipeline-stage {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-top: 4px solid #3498db;
        }

        .pipeline-count {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .pipeline-label {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: var(--secondary-color);
        }

        .action-btn.secondary {
            background: var(--text-secondary);
        }

        .action-btn.secondary:hover {
            background: var(--text-primary);
        }

        /* Enhanced Table Styles */
        .enhanced-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .enhanced-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .enhanced-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .enhanced-table tr:hover {
            background: #f8f9fa;
        }

        .enhanced-table .highlight {
            background: #e8f5e8;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background: #00b894; }
        .status-pending { background: #fdcb6e; }
        .status-inactive { background: #e17055; }

        /* Responsive Enhancements */
        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-row input[type="text"],
            .filter-row select {
                min-width: auto;
            }
            
            .pipeline-visualization {
                flex-direction: column;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dark mode enhancements */
        body.dark-mode .filter-controls select,
        body.dark-mode .filter-row input[type="text"],
        body.dark-mode .filter-row select {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        body.dark-mode .analytics-card {
            background: #34495e;
        }

        body.dark-mode .pipeline-stage {
            background: #34495e;
        }

        body.dark-mode .enhanced-table {
            background: #34495e;
        }

        body.dark-mode .enhanced-table td {
            border-bottom-color: #4a5568;
        }

        body.dark-mode .enhanced-table tr:hover {
            background: #2c3e50;
        }

        /* History Section Styles */
        .history-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-container {
            margin-top: 20px;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .history-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
            transition: transform 0.3s;
        }

        .history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .history-date {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .history-scores {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .score-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .score-badge.sentiment-positive { background: #00b894; color: white; }
        .score-badge.sentiment-neutral { background: #fdcb6e; color: var(--text-primary); }
        .score-badge.sentiment-negative { background: #e17055; color: white; }
        .score-badge.confidence { background: #3498db; color: white; }

        .history-text {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .history-summary {
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s;
        }

        .btn-small:hover {
            background: #2980b9;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .history-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Dark mode styles */
        body.dark-mode {
            background: var(--gradient-dark);
            color: var(--text-primary);
        }

        body.dark-mode .dashboard-card,
        body.dark-mode .header,
        body.dark-mode .history-section {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        body.dark-mode .data-table {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        body.dark-mode .data-table th {
            background: var(--gradient-card-dark);
        }

        body.dark-mode .data-table td {
            border-bottom-color: var(--border-color);
        }

        body.dark-mode .history-card {
            background: var(--bg-secondary);
        }
    </style>
</head>
<body>
    <!-- Particle system for ultra-realistic effects -->
    <div id="particles" class="particles"></div>
    
    <!-- Animated background -->
    <div class="animated-bg"></div>
    
    <div class="container">
        <div class="header">
            <h1>📊 DealFlowAI Dashboard</h1>
            <div class="header-info">
                <div class="last-update">
                    <span class="live-indicator"></span>
                    <span id="lastUpdateTime">Last updated: Just now</span>
                </div>
                <div class="nav-links">
                    <a href="/">🏠 Home</a>
                    <a href="/thesis-analyzer/">📝 Thesis Analyzer</a>
                    <a href="/dashboard/">📊 Dashboard</a>
                    <a href="/admin/">🔧 Admin</a>
                    <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
                </div>
            </div>
        </div>

        <div id="dashboardContent" class="loading">
            Loading dashboard data...
        </div>
    </div>

    <script>
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = isDark ? '🌙' : '☀️';
            
            // Store preference
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }
        
        // Initialize theme from localStorage
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = savedTheme === 'dark' ? '☀️' : '🌙';
        }

        // Create particle system
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size between 2-6px
                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random position
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                
                particlesContainer.appendChild(particle);
            }
        }

        // Mouse tracking for interactive effects
        function initMouseTracking() {
            document.addEventListener('mousemove', function(e) {
                const mouseX = e.clientX / window.innerWidth;
                const mouseY = e.clientY / window.innerHeight;
                
                // Subtle background movement based on mouse position
                const animatedBg = document.querySelector('.animated-bg');
                if (animatedBg) {
                    animatedBg.style.transform = `translate(${mouseX * 20}px, ${mouseY * 20}px)`;
                }
                
                // Interactive particle movement
                const particles = document.querySelectorAll('.particle');
                particles.forEach((particle, index) => {
                    const speed = (index % 3 + 1) * 0.5;
                    particle.style.transform = `translate(${mouseX * speed * 10}px, ${mouseY * speed * 10}px)`;
                });
            });
        }

        // Initialize theme and load dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadDashboard();
            simulateRealTimeData(); // Start real-time data simulation
            createParticles(); // Create particle system
            initMouseTracking(); // Initialize mouse tracking
        });

        // Load dashboard data
        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard-stats/');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                window.dashboardData = data; // Store data globally for export/report
                displayDashboard(data);
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('dashboardContent').innerHTML = `
                    <div class="error">
                        <strong>❌ Error:</strong> Failed to load dashboard data.
                    </div>
                `;
            }
        }

        function displayDashboard(data) {
            const dashboardContent = document.getElementById('dashboardContent');
            
            let html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${data.total_companies || 0}</div>
                        <div class="metric-label">🏢 Total Companies</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.total_deals || 0}</div>
                        <div class="metric-label">💼 Total Deals</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.total_theses || 0}</div>
                        <div class="metric-label">📚 Investment Theses</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${((data.thesis_summary?.avg_fit_score || 0) * 100).toFixed(1)}%</div>
                        <div class="metric-label">📈 Avg Fit Score</div>
                    </div>
                </div>

                <!-- Advanced Analytics Section -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">📊 Advanced Analytics</div>
                        <div class="filter-controls">
                            <select id="timeFilter" onchange="loadAdvancedAnalytics()">
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="180">Last 6 Months</option>
                                <option value="365">Last Year</option>
                            </select>
                        </div>
                    </div>
                    <div id="advancedAnalytics" class="loading">
                        Loading advanced analytics...
                    </div>
                </div>

                <!-- Advanced Visualizations Section -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">📈 Advanced Visualizations</div>
                        <div class="filter-controls">
                            <button onclick="loadAdvancedVisualizations()" class="btn-small">Refresh</button>
                        </div>
                    </div>
                    <div class="visualization-grid">
                        <!-- Industry Heatmap -->
                        <div class="viz-card">
                            <h4>Industry Heatmap</h4>
                            <div id="industryHeatmap" class="heatmap-container"></div>
                        </div>
                        
                        <!-- Pipeline Funnel -->
                        <div class="viz-card">
                            <h4>Deal Pipeline Funnel</h4>
                            <div id="pipelineFunnel" class="funnel-container"></div>
                        </div>
                        
                        <!-- Thesis Timeline -->
                        <div class="viz-card">
                            <h4>Thesis Sentiment Timeline</h4>
                            <div id="thesisTimeline" class="chart-container"></div>
                        </div>
                        
                        <!-- Funding Distribution -->
                        <div class="viz-card">
                            <h4>Funding Stage Distribution</h4>
                            <div id="fundingDistribution" class="chart-container"></div>
                        </div>
                        
                        <!-- Performance Timeline -->
                        <div class="viz-card">
                            <h4>Performance Timeline</h4>
                            <div id="performanceTimeline" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Search and Filter Section -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">🔍 Search & Filters</div>
                    </div>
                    <div class="filter-section">
                        <div class="filter-row">
                            <input type="text" id="searchInput" placeholder="Search companies, deals, or theses..." onkeyup="filterData()">
                            <select id="industryFilter" onchange="filterData()">
                                <option value="">All Industries</option>
                                <option value="software">Software</option>
                                <option value="fintech">FinTech</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="energy">Energy</option>
                                <option value="education">Education</option>
                                <option value="retail">Retail</option>
                                <option value="logistics">Logistics</option>
                                <option value="cybersecurity">Cybersecurity</option>
                                <option value="ai_ml">AI/ML</option>
                            </select>
                            <select id="statusFilter" onchange="filterData()">
                                <option value="">All Statuses</option>
                                <option value="prospecting">Prospecting</option>
                                <option value="qualification">Qualification</option>
                                <option value="proposal">Proposal</option>
                                <option value="negotiation">Negotiation</option>
                                <option value="due_diligence">Due Diligence</option>
                                <option value="closed_won">Closed Won</option>
                                <option value="closed_lost">Closed Lost</option>
                            </select>
                            <button onclick="resetFilters()" class="btn-small">Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">⚡ Quick Actions</div>
                    </div>
                    <div class="quick-actions">
                        <a href="/thesis-analyzer/" class="action-btn">
                            📝 New Thesis Analysis
                        </a>
                        <a href="/admin/deals/company/add/" class="action-btn secondary">
                            🏢 Add Company
                        </a>
                        <a href="/admin/deals/deal/add/" class="action-btn secondary">
                            💼 Create Deal
                        </a>
                        <button onclick="exportData()" class="action-btn secondary">
                            📊 Export Data
                        </button>
                        <button onclick="generateReport()" class="action-btn secondary">
                            📋 Generate Report
                        </button>
                        <button onclick="refreshDashboard()" class="action-btn secondary">
                            🔄 Refresh
                        </button>
                    </div>
                </div>

                <!-- Performance Overview -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">📈 Performance Overview</div>
                    </div>
                    <div class="performance-metrics">
                        <div class="performance-card">
                            <div class="performance-value" id="conversionRate">0%</div>
                            <div class="performance-label">Conversion Rate</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="avgDealSize">$0M</div>
                            <div class="performance-label">Avg Deal Size</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="pipelineValue">$0M</div>
                            <div class="performance-label">Pipeline Value</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="avgFitScore">0%</div>
                            <div class="performance-label">Avg Fit Score</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">📊 Deal Status Breakdown</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="dealStatusChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">🏭 Industry Distribution</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="industryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">📋 Recent Deals</div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Deal Title</th>
                                    <th>Company</th>
                                    <th>Status</th>
                                    <th>Fit Score</th>
                                    <th>Value ($M)</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            if (data.recent_deals && data.recent_deals.length > 0) {
                data.recent_deals.forEach(deal => {
                    const fitClass = deal.fit_score >= 0.8 ? 'fit-high' : deal.fit_score >= 0.6 ? 'fit-medium' : 'fit-low';
                    html += `
                        <tr>
                            <td>${deal.title}</td>
                            <td>${deal.company_name}</td>
                            <td><span class="status-badge status-${deal.status}">${deal.status.replace('_', ' ').toUpperCase()}</span></td>
                            <td><span class="fit-score ${fitClass}">${(deal.fit_score * 100).toFixed(1)}%</span></td>
                            <td>$${deal.value.toFixed(1)}M</td>
                            <td>${deal.created_at}</td>
                        </tr>
                    `;
                });
            } else {
                html += '<tr><td colspan="6" style="text-align: center; padding: 40px;">No recent deals found</td></tr>';
            }
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">🏆 Top Companies by Similarity Score</div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>Industry</th>
                                    <th>Revenue Range</th>
                                    <th>Funding Stage</th>
                                    <th>Similarity Score</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            if (data.top_companies && data.top_companies.length > 0) {
                data.top_companies.forEach(company => {
                    html += `
                        <tr>
                            <td>${company.name}</td>
                            <td>${company.industry.toUpperCase()}</td>
                            <td>${company.revenue_range.replace('_', ' - ').toUpperCase()}</td>
                            <td>${company.funding_stage.replace('_', ' ').toUpperCase()}</td>
                            <td><span class="fit-score fit-high">${(company.similarity_score * 100).toFixed(1)}%</span></td>
                        </tr>
                    `;
                });
            } else {
                html += '<tr><td colspan="5" style="text-align: center; padding: 40px;">No companies found</td></tr>';
            }
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Thesis Analysis History Section -->
                <div class="history-section">
                    <div class="section-title">📚 Thesis Analysis History</div>
                    <div id="thesisHistory" class="history-container">
                        <div class="loading">Loading thesis history...</div>
                    </div>
                </div>
            `;
            
            // Empty state if no data
            if ((!data.total_companies || data.total_companies === 0) && 
                (!data.total_deals || data.total_deals === 0)) {
                html = `
                    <div class="empty-state">
                        <h3>📊 No Data Available</h3>
                        <p>Start by adding companies and creating deals to see your dashboard analytics.</p>
                        <a href="/admin/" class="btn">🔧 Go to Admin Panel</a>
                        <a href="/" class="home-btn">🏠 Go to Home</a>
                    </div>
                `;
            }
            
            dashboardContent.innerHTML = html;
            
            // Initialize charts
            if (data.deal_statuses && data.deal_statuses.length > 0) {
                createDealStatusChart(data.deal_statuses);
            }
            
            if (data.industry_breakdown && data.industry_breakdown.length > 0) {
                createIndustryChart(data.industry_breakdown);
            }
            
            // Load thesis history
            loadThesisHistory();
        }

        // Create deal status chart
        function createDealStatusChart(dealStatuses) {
            const ctx = document.getElementById('dealStatusChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dealStatuses.map(item => item.status.replace('_', ' ').toUpperCase()),
                    datasets: [{
                        data: dealStatuses.map(item => item.count),
                        backgroundColor: [
                            '#3498db',
                            '#e74c3c',
                            '#f39c12',
                            '#27ae60',
                            '#9b59b6',
                            '#1abc9c',
                            '#34495e'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Create industry chart
        function createIndustryChart(industryBreakdown) {
            const ctx = document.getElementById('industryChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: industryBreakdown.map(item => item.industry.toUpperCase()),
                    datasets: [{
                        label: 'Companies',
                        data: industryBreakdown.map(item => item.count),
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Load advanced analytics
        async function loadAdvancedAnalytics() {
            const timeFilter = document.getElementById('timeFilter').value;
            const industryFilter = document.getElementById('industryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchInput = document.getElementById('searchInput').value;

            const advancedAnalyticsContent = document.getElementById('advancedAnalytics');
            advancedAnalyticsContent.innerHTML = '<div class="loading">Loading advanced analytics...</div>';

            try {
                const params = new URLSearchParams({
                    time_period: timeFilter,
                    industry: industryFilter,
                    status: statusFilter,
                    search: searchInput
                });
                const response = await fetch(`/api/advanced-analytics/?${params.toString()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                displayAdvancedAnalytics(data);
                
            } catch (error) {
                console.error('Error loading advanced analytics:', error);
                advancedAnalyticsContent.innerHTML = `
                    <div class="error">
                        <strong>❌ Error:</strong> Failed to load advanced analytics.
                    </div>
                `;
            }
        }

        function displayAdvancedAnalytics(data) {
            const advancedAnalyticsContent = document.getElementById('advancedAnalytics');
            
            let html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${data.total_companies || 0}</div>
                        <div class="metric-label">🏢 Total Companies</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.total_deals || 0}</div>
                        <div class="metric-label">💼 Total Deals</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.total_theses || 0}</div>
                        <div class="metric-label">📚 Investment Theses</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${((data.thesis_summary?.avg_fit_score || 0) * 100).toFixed(1)}%</div>
                        <div class="metric-label">📈 Avg Fit Score</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">📊 Deal Status Breakdown</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="dealStatusChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">🏭 Industry Distribution</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="industryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">📋 Recent Deals</div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Deal Title</th>
                                    <th>Company</th>
                                    <th>Status</th>
                                    <th>Fit Score</th>
                                    <th>Value ($M)</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            if (data.recent_deals && data.recent_deals.length > 0) {
                data.recent_deals.forEach(deal => {
                    const fitClass = deal.fit_score >= 0.8 ? 'fit-high' : deal.fit_score >= 0.6 ? 'fit-medium' : 'fit-low';
                    html += `
                        <tr>
                            <td>${deal.title}</td>
                            <td>${deal.company_name}</td>
                            <td><span class="status-badge status-${deal.status}">${deal.status.replace('_', ' ').toUpperCase()}</span></td>
                            <td><span class="fit-score ${fitClass}">${(deal.fit_score * 100).toFixed(1)}%</span></td>
                            <td>$${deal.value.toFixed(1)}M</td>
                            <td>${deal.created_at}</td>
                        </tr>
                    `;
                });
            } else {
                html += '<tr><td colspan="6" style="text-align: center; padding: 40px;">No recent deals found</td></tr>';
            }
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">🏆 Top Companies by Similarity Score</div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>Industry</th>
                                    <th>Revenue Range</th>
                                    <th>Funding Stage</th>
                                    <th>Similarity Score</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            if (data.top_companies && data.top_companies.length > 0) {
                data.top_companies.forEach(company => {
                    html += `
                        <tr>
                            <td>${company.name}</td>
                            <td>${company.industry.toUpperCase()}</td>
                            <td>${company.revenue_range.replace('_', ' - ').toUpperCase()}</td>
                            <td>${company.funding_stage.replace('_', ' ').toUpperCase()}</td>
                            <td><span class="fit-score fit-high">${(company.similarity_score * 100).toFixed(1)}%</span></td>
                        </tr>
                    `;
                });
            } else {
                html += '<tr><td colspan="5" style="text-align: center; padding: 40px;">No companies found</td></tr>';
            }
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Thesis Analysis History Section -->
                <div class="history-section">
                    <div class="section-title">📚 Thesis Analysis History</div>
                    <div id="thesisHistory" class="history-container">
                        <div class="loading">Loading thesis history...</div>
                    </div>
                </div>
            `;
            
            advancedAnalyticsContent.innerHTML = html;
            
            // Initialize charts
            if (data.deal_statuses && data.deal_statuses.length > 0) {
                createDealStatusChart(data.deal_statuses);
            }
            
            if (data.industry_breakdown && data.industry_breakdown.length > 0) {
                createIndustryChart(data.industry_breakdown);
            }
            
            // Load thesis history
            loadThesisHistory();
        }

        // Load thesis history
        async function loadThesisHistory() {
            console.log('loadThesisHistory called');
            const historyContainer = document.getElementById('thesisHistory');
            console.log('historyContainer:', historyContainer);
            
            if (!historyContainer) {
                console.error('thesisHistory container not found');
                return;
            }
            
            try {
                console.log('Fetching thesis history...');
                const response = await fetch('/api/thesis-history/');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Thesis history data:', data);
                displayThesisHistory(data);
                
            } catch (error) {
                console.error('Error loading thesis history:', error);
                if (historyContainer) {
                    historyContainer.innerHTML = `
                        <div class="error">
                            <strong>❌ Error:</strong> Failed to load thesis history.
                        </div>
                    `;
                }
            }
        }

        function displayThesisHistory(data) {
            console.log('displayThesisHistory called with data:', data);
            const historyContainer = document.getElementById('thesisHistory');
            console.log('historyContainer in displayThesisHistory:', historyContainer);
            
            if (!historyContainer) {
                console.error('thesisHistory container not found in displayThesisHistory');
                return;
            }
            
            if (!data.history || data.history.length === 0) {
                console.log('No history data available');
                historyContainer.innerHTML = `
                    <div class="empty-history">
                        <p>No thesis analysis history available.</p>
                        <a href="/thesis-analyzer/" class="btn">📝 Start Your First Analysis</a>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="history-grid">';
            
            data.history.forEach(thesis => {
                const sentimentClass = thesis.sentiment_score >= 0.7 ? 'sentiment-positive' : 
                                     thesis.sentiment_score >= 0.4 ? 'sentiment-neutral' : 'sentiment-negative';
                
                html += `
                    <div class="history-card">
                        <div class="history-header">
                            <div class="history-date">📅 ${thesis.created_at}</div>
                            <div class="history-scores">
                                <span class="score-badge sentiment ${sentimentClass}">
                                    Sentiment: ${(thesis.sentiment_score * 100).toFixed(1)}%
                                </span>
                                <span class="score-badge confidence">
                                    Confidence: ${(thesis.confidence_score * 100).toFixed(1)}%
                                </span>
                            </div>
                        </div>
                        <div class="history-text">
                            <strong>Thesis:</strong> ${thesis.short_text}
                        </div>
                        <div class="history-summary">
                            <strong>Summary:</strong> ${thesis.summary || 'Analysis completed successfully'}
                        </div>
                        <div class="history-actions">
                            <button onclick="viewThesisDetails(${thesis.id})" class="btn-small">👁️ View Details</button>
                            <button onclick="reanalyzeThesis('${thesis.text}')" class="btn-small">🔄 Reanalyze</button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            historyContainer.innerHTML = html;
        }

        function viewThesisDetails(thesisId) {
            // Navigate to thesis details page with the thesis ID
            window.location.href = `/thesis-details/?id=${thesisId}`;
        }

        function reanalyzeThesis(thesisText) {
            // Navigate to thesis analyzer with the thesis text
            window.location.href = `/thesis-analyzer/?thesis_text=${encodeURIComponent(thesisText)}`;
        }

        // Filter data (search, industry, status)
        function filterData() {
            loadAdvancedAnalytics();
        }

        function resetFilters() {
            document.getElementById('timeFilter').value = '30'; // Default to last 30 days
            document.getElementById('industryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('searchInput').value = '';
            loadAdvancedAnalytics();
        }

        // Export data functionality
        function exportData() {
            const timeFilter = document.getElementById('timeFilter').value;
            const industryFilter = document.getElementById('industryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            // Create CSV data
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Dashboard Export\n";
            csvContent += "Date," + new Date().toISOString().split('T')[0] + "\n";
            csvContent += "Filters: Time=" + timeFilter + " days, Industry=" + industryFilter + ", Status=" + statusFilter + "\n\n";
            
            // Add basic metrics
            csvContent += "Metric,Value\n";
            csvContent += "Total Companies," + (window.dashboardData?.total_companies || 0) + "\n";
            csvContent += "Total Deals," + (window.dashboardData?.total_deals || 0) + "\n";
            csvContent += "Total Theses," + (window.dashboardData?.total_theses || 0) + "\n";
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "dealflow_dashboard_export.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Generate report functionality
        function generateReport() {
            const reportWindow = window.open('', '_blank', 'width=800,height=600');
            const reportData = window.dashboardData || {};
            
            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>DealFlowAI Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 30px; }
                        .metric { display: inline-block; margin: 10px; padding: 15px; background: #f0f0f0; border-radius: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: var(--bg-secondary); }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>DealFlowAI Dashboard Report</h1>
                        <p>Generated on ${new Date().toLocaleString()}</p>
                    </div>
                    
                    <div class="section">
                        <h2>Key Metrics</h2>
                        <div class="metric">Total Companies: ${reportData.total_companies || 0}</div>
                        <div class="metric">Total Deals: ${reportData.total_deals || 0}</div>
                        <div class="metric">Total Theses: ${reportData.total_theses || 0}</div>
                        <div class="metric">Avg Fit Score: ${((reportData.thesis_summary?.avg_fit_score || 0) * 100).toFixed(1)}%</div>
                    </div>
                    
                    <div class="section">
                        <h2>Deal Status Breakdown</h2>
                        <table>
                            <tr><th>Status</th><th>Count</th><th>Percentage</th></tr>
                            ${(reportData.deal_statuses || []).map(status => 
                                `<tr><td>${status.status}</td><td>${status.count}</td><td>${status.percentage?.toFixed(1)}%</td></tr>`
                            ).join('')}
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>Industry Distribution</h2>
                        <table>
                            <tr><th>Industry</th><th>Count</th></tr>
                            ${(reportData.industry_breakdown || []).map(industry => 
                                `<tr><td>${industry.industry}</td><td>${industry.count}</td></tr>`
                            ).join('')}
                        </table>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        }

        // Refresh dashboard
        function refreshDashboard() {
            loadDashboard();
            loadAdvancedAnalytics();
            loadThesisHistory();
            loadPerformanceMetrics();
        }
        
        // Function to refresh dashboard after thesis analysis
        function refreshAfterThesisAnalysis() {
            console.log('Refreshing dashboard after thesis analysis...');
            refreshDashboard();
        }
        
        // Smart auto-refresh dashboard every 60 seconds (reduced frequency)
        let refreshInterval = setInterval(function() {
            console.log('Smart refreshing dashboard...');
            const oldHistoryCount = document.querySelectorAll('.history-card').length;
            
            Promise.all([
                loadThesisHistory(),
                loadAdvancedAnalytics(),
                loadPerformanceMetrics()
            ]).then(() => {
                const newHistoryCount = document.querySelectorAll('.history-card').length;
                
                if (newHistoryCount > oldHistoryCount) {
                    showNotification('🆕 New thesis analysis detected! Dashboard updated.');
                }
                
                // Update timestamp
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                const timestampElement = document.getElementById('lastUpdateTime');
                if (timestampElement) {
                    timestampElement.textContent = `Last updated: ${timeString}`;
                }
            }).catch(error => {
                console.error('Error during auto-refresh:', error);
            });
        }, 60000); // 60 seconds for better performance
        
        // Function to stop auto-refresh
        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                console.log('Auto-refresh stopped');
            }
        }
        
        // Function to start auto-refresh
        function startAutoRefresh() {
            stopAutoRefresh(); // Clear existing interval
            refreshInterval = setInterval(function() {
                console.log('Smart refreshing dashboard...');
                const oldHistoryCount = document.querySelectorAll('.history-card').length;
                
                Promise.all([
                    loadThesisHistory(),
                    loadAdvancedAnalytics(),
                    loadPerformanceMetrics()
                ]).then(() => {
                    const newHistoryCount = document.querySelectorAll('.history-card').length;
                    
                    if (newHistoryCount > oldHistoryCount) {
                        showNotification('🆕 New thesis analysis detected! Dashboard updated.');
                    }
                    
                    // Update timestamp
                    const now = new Date();
                    const timeString = now.toLocaleTimeString();
                    const timestampElement = document.getElementById('lastUpdateTime');
                    if (timestampElement) {
                        timestampElement.textContent = `Last updated: ${timeString}`;
                    }
                }).catch(error => {
                    console.error('Error during auto-refresh:', error);
                });
            }, 60000);
        }
        
        // Show notification function
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--gradient-secondary);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 10px;
                    box-shadow: var(--shadow);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                ">
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Load performance metrics
        async function loadPerformanceMetrics() {
            try {
                const response = await fetch('/api/advanced-analytics/');
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update performance metrics
                    document.getElementById('conversionRate').textContent = 
                        data.pipeline?.conversion_rate?.toFixed(1) + '%' || '0%';
                    document.getElementById('avgDealSize').textContent = 
                        '$' + (data.pipeline?.avg_deal_size / 1000000).toFixed(1) + 'M' || '$0M';
                    document.getElementById('pipelineValue').textContent = 
                        '$' + (data.pipeline?.total_value / 1000000).toFixed(1) + 'M' || '$0M';
                    document.getElementById('avgFitScore').textContent = 
                        (data.thesis_trends?.avg_sentiment * 100).toFixed(1) + '%' || '0%';
                }
            } catch (error) {
                console.error('Error loading performance metrics:', error);
            }
        }

        // Enhanced chart creation with animations and real-time updates
        function createEnhancedChart(canvasId, data, type = 'bar') {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;
            
            // Store chart data globally for comparison
            window.currentChartData = window.currentChartData || {};
            window.currentChartData[canvasId] = data;
            
            const chart = new Chart(ctx, {
                type: type,
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        y: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    }
                }
            });
            
            return chart;
        }

        // Real-time data streaming simulation (disabled to prevent excessive loading)
        function simulateRealTimeData() {
            // Disabled to prevent dashboard loading issues
            console.log('Real-time data simulation disabled for performance');
        }
        function createEnhancedChart(ctx, type, data, options) {
            const chart = new Chart(ctx, {
                type: type,
                data: data,
                options: {
                    ...options,
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#3498db',
                            borderWidth: 1
                        }
                    }
                }
            });
            return chart;
        }

        // Load advanced visualizations
        async function loadAdvancedVisualizations() {
            try {
                const response = await fetch('/api/advanced-visualizations/');
                if (response.ok) {
                    const data = await response.json();
                    displayAdvancedVisualizations(data);
                }
            } catch (error) {
                console.error('Error loading advanced visualizations:', error);
            }
        }

        // Display advanced visualizations
        function displayAdvancedVisualizations(data) {
            // Create industry heatmap
            if (data.industry_heatmap) {
                createIndustryHeatmap(data.industry_heatmap);
            }
            
            // Create pipeline funnel
            if (data.pipeline_funnel) {
                createPipelineFunnel(data.pipeline_funnel);
            }
            
            // Create thesis timeline
            if (data.thesis_timeline) {
                createThesisTimeline(data.thesis_timeline);
            }
            
            // Create funding distribution
            if (data.funding_distribution) {
                createFundingDistribution(data.funding_distribution);
            }
            
            // Create performance timeline
            if (data.performance_timeline) {
                createPerformanceTimeline(data.performance_timeline);
            }
        }

        // Create industry heatmap
        function createIndustryHeatmap(industryData) {
            const container = document.getElementById('industryHeatmap');
            if (!container) return;
            
            const industries = Object.keys(industryData);
            const maxCount = Math.max(...industries.map(ind => industryData[ind].count));
            
            container.innerHTML = '';
            industries.forEach(industry => {
                const data = industryData[industry];
                const intensity = (data.count / maxCount) * 100;
                
                const heatmapItem = document.createElement('div');
                heatmapItem.className = 'heatmap-item';
                heatmapItem.style.cssText = `
                    background: linear-gradient(135deg, rgba(102, 126, 234, ${intensity/100}), rgba(118, 75, 162, ${intensity/100}));
                    padding: 15px;
                    border-radius: 10px;
                    margin: 10px;
                    color: white;
                    text-align: center;
                    min-width: 150px;
                `;
                
                heatmapItem.innerHTML = `
                    <h4>${industry}</h4>
                    <p>Companies: ${data.count}</p>
                    <p>Avg Funding: $${(data.avg_funding/1000000).toFixed(1)}M</p>
                    <p>Avg Employees: ${Math.round(data.avg_employees)}</p>
                `;
                
                container.appendChild(heatmapItem);
            });
        }

        // Create pipeline funnel
        function createPipelineFunnel(funnelData) {
            const container = document.getElementById('pipelineFunnel');
            if (!container) return;
            
            const stages = ['prospecting', 'qualification', 'proposal', 'negotiation', 'closed_won', 'closed_lost'];
            const colors = ['#667eea', '#764ba2', '#4CAF50', '#FF9800', '#2196F3', '#F44336'];
            
            container.innerHTML = '';
            stages.forEach((stage, index) => {
                const count = funnelData[stage] || 0;
                const width = Math.max(20, (count / Math.max(...Object.values(funnelData))) * 100);
                
                const funnelItem = document.createElement('div');
                funnelItem.className = 'funnel-item';
                funnelItem.style.cssText = `
                    background: ${colors[index]};
                    width: ${width}%;
                    height: 40px;
                    margin: 5px 0;
                    border-radius: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    transition: all 0.3s ease;
                `;
                
                funnelItem.innerHTML = `
                    <span>${stage.charAt(0).toUpperCase() + stage.slice(1)}: ${count}</span>
                `;
                
                container.appendChild(funnelItem);
            });
        }

        // Create thesis timeline
        function createThesisTimeline(timelineData) {
            const container = document.getElementById('thesisTimeline');
            if (!container) return;
            
            const canvas = document.createElement('canvas');
            canvas.id = 'thesisTimelineChart';
            canvas.style.width = '100%';
            canvas.style.height = '300px';
            container.innerHTML = '';
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timelineData.map(item => item.date),
                    datasets: [{
                        label: 'Sentiment Score',
                        data: timelineData.map(item => item.sentiment),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Confidence Score',
                        data: timelineData.map(item => item.confidence),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    }
                }
            });
        }

        // Create funding distribution
        function createFundingDistribution(fundingData) {
            const container = document.getElementById('fundingDistribution');
            if (!container) return;
            
            const canvas = document.createElement('canvas');
            canvas.id = 'fundingDistributionChart';
            canvas.style.width = '100%';
            canvas.style.height = '300px';
            container.innerHTML = '';
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(fundingData).map(stage => stage.charAt(0).toUpperCase() + stage.slice(1)),
                    datasets: [{
                        data: Object.values(fundingData),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#4CAF50', '#FF9800', '#2196F3', '#F44336'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary'),
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        // Create performance timeline
        function createPerformanceTimeline(timelineData) {
            const container = document.getElementById('performanceTimeline');
            if (!container) return;
            
            const canvas = document.createElement('canvas');
            canvas.id = 'performanceTimelineChart';
            canvas.style.width = '100%';
            canvas.style.height = '300px';
            container.innerHTML = '';
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: timelineData.map(item => item.month),
                    datasets: [{
                        label: 'Deals Count',
                        data: timelineData.map(item => item.deals_count),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }, {
                        label: 'Theses Count',
                        data: timelineData.map(item => item.theses_count),
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: '#4CAF50',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        },
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary')
                            },
                            grid: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
                            }
                        }
                    }
                }
            });
        }

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadPerformanceMetrics();
            loadAdvancedVisualizations();
        });
    </script>
</body>
</html> 